(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,n){e.exports=n(20)},15:function(e,t,n){},16:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(5),l=n.n(i),o=(n(15),n(1)),c=(n(16),n(6)),u=n.n(c);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200;if(!(this instanceof s))return new s(e,t,n);this.dummy=!1,this.Ne=0,"object"===typeof e?Object.assign(this,e):(this.firstName=e,this.lastName=t,this.rating=n)}s.prototype.eloRank=function(e){var t=e.round.tourney.playerMatchHistory(this).length,n=800/(this.Ne+t);return new u.a(n)};var m=s("Dummy");function h(e,t,n){if(!(this instanceof h))return new h(e,t,n);this.round=e,this.players=[t,n],this.result=[0,0],this.origRating=[t.rating,n.rating],this.newRating=[t.rating,n.rating];var r=this.players.map(function(e){return e.dummy});r[0]?this.result=[0,1]:r[1]&&(this.result=[1,0])}function p(e){var t=e.whitePlayer.eloRank(e),n=e.blackPlayer.eloRank(e),r=[t.getExpected(e.whiteOrigRating,e.blackOrigRating),n.getExpected(e.blackOrigRating,e.whiteOrigRating)];e.newRating=[t.updateRating(r[0],e.result[0],e.whiteOrigRating),n.updateRating(r[1],e.result[1],e.blackOrigRating)],e.newRating=e.newRating.map(function(e){return e<100?100:e}),e.whitePlayer.rating=e.newRating[0],e.blackPlayer.rating=e.newRating[1]}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!(this instanceof f))return new f(e,t);this.all=e,this.tourney=t,this.inactive=[]}m.dummy=!0,m.rating=0,Object.defineProperties(h.prototype,{whitePlayer:{get:function(){return this.players[0]},set:function(e){this.players[0]=e}},blackPlayer:{get:function(){return this.players[1]},set:function(e){this.players[1]=e}},whiteOrigRating:{get:function(){return this.origRating[0]}},blackOrigRating:{get:function(){return this.origRating[1]}},isComplete:{get:function(){return 0!==this.result.reduce(function(e,t){return e+t})}},isBye:{get:function(){return this.players.includes(m)}}}),h.prototype.playerInfo=function(e){var t=this.players.indexOf(e);return-1!==t&&{origRating:this.origRating[t],newRating:this.newRating[t],score:this.result[t],color:t}},h.prototype.blackWon=function(){return this.result=[0,1],p(this),this},h.prototype.whiteWon=function(){return this.result=[1,0],p(this),this},h.prototype.draw=function(){return this.result=[.5,.5],p(this),this},h.prototype.resetResult=function(){return this.result=[0,0],this.newRating=this.origRating,this},Object.defineProperties(f.prototype,{active:{get:function(){var e=this;return this.all.filter(function(t){return!e.inactive.includes(t)})}}}),f.prototype.addPlayer=function(e){return this.all.push(e),this},f.prototype.addPlayers=function(e){return this.all=this.all.concat(e),this},f.prototype.deactivatePlayer=function(e){return this.inactive.push(e),this},f.prototype.activatePlayer=function(e){return this.inactive.splice(this.inactive.indexOf(e),1),this},f.prototype.removePlayer=function(e){return this.tourney.playerMatchHistory(e).length>0?null:(delete this.all[this.all.indexOf(e)],this)};var d=n(9),y=n(8),g=n(2);function v(e,t,n,r){if(!(this instanceof v))return new v(e,t,n,r);var a;this.id=t,this.tourney=e,this.roster=r,this.prevRound=n,this.playerTree={},this.matches=[],this.hasDummy=!1,(a=this).roster.forEach(function(e){var t=a.tourney.playerScore(e);t in a.playerTree||(a.playerTree[t]=[]),a.playerTree[t].push(e)}),Object.keys(a.playerTree).reverse().forEach(function(e,t,n){var r=a.playerTree[e];if(r.length%2!==0)if(a.roster.length%2===0||a.hasDummy){var i=r[r.length-1];r.splice(r.length-1,1);var l=n[t+1];l in a.playerTree||(a.playerTree[l]=[]),a.playerTree[l].push(i)}else r.push(m),a.hasDummy=!0;0===r.length?delete a.playerTree[e]:a.playerTree[e]=Object(g.chain)(r).sortBy("rating").reverse().chunk(r.length/2).value()}),Object.keys(a.playerTree).forEach(function(e){var t=a.playerTree[e][0],n=a.playerTree[e][1];if(void 0===a.prevRound)Object(g.zip)(t,n).forEach(function(e){return a.matches.push(Object(d.a)(h,[a].concat(Object(y.a)(e))))});else{try{var r=t.map(function(e){return[].concat(n).concat(t).filter(function(t){return a.tourney.playerOppHistory(t).includes(e)})})}catch(i){throw console.log(e,a.playerTree[e]),i}t.forEach(function(e){var i=r[t.indexOf(e)],l=Object(g.flatten)(r.slice(t.indexOf(e))),c=E(a,e,n.filter(function(e){return l.includes(e)}),i),u=Object(o.a)(c,2),s=u[0],m=u[1];if(!s){var h=E(a,e,n,i),p=Object(o.a)(h,2);s=p[0],m=p[1]}if(!s){var f=E(a,e,n,[]),d=Object(o.a)(f,2);s=d[0],m=d[1]}if(i.includes(s)){var y=!1;t.filter(function(t){return t!==e}).forEach(function(n){if(!y){var l=a.matches.filter(function(e){return e.players.includes(n)})[0];if(l){var o=l.players.filter(function(e){return e!==n})[0],c=r[t.indexOf(n)];i.includes(o)||c.includes(s)||(m.players=[e,o],l.players=[n,s],y=!0)}}})}})}}),a.matches}function E(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=e.prevRound.playerColor(t),l=n.filter(function(e){return!a.includes(e)}).filter(function(e){return e!==t}).filter(function(t){return!Object(g.flatten)(e.matches.map(function(e){return e.players})).includes(t)}),o=n.filter(function(t){return i!==e.prevRound.playerColor(t)}),c=l.filter(function(e){return o.includes(e)})[0]||l[0];return c&&(r=new h(e,t,c),e.tourney.playerColorBalance(t)>e.tourney.playerColorBalance(c)&&r.players.reverse(),e.matches.push(r)),[c,r]}Object.defineProperties(v.prototype,{isComplete:{get:function(){return!this.matches.map(function(e){return e.isComplete}).includes(!1)}}}),v.prototype.matchByPlayer=function(e){var t=null;return this.matches.forEach(function(n){n.players.includes(e)&&(t=n)}),t},v.prototype.playerColor=function(e){var t=-1;return this.matches.forEach(function(n){n.players.includes(e)&&(t=n.players.indexOf(e))}),t},v.prototype.addPlayer=function(e){return this.players.push(e),this};var b=n(7);function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!(this instanceof O))return new O(e,t,n,r);this.name=e,this.timeControl=t,this.roster=f(n,this),this.roundList=[],this.byeValue=r}Object.defineProperties(O.prototype,{isNewRoundReady:{get:function(){return this.roundList.length>0?Object(g.last)(this.roundList).isComplete:this.roster.all.length>0}}}),O.prototype.numOfRounds=function(){var e=Math.ceil(Math.log2(this.roster.active.length));return e===-1/0&&(e=0),e},O.prototype.newRound=function(){if(!this.isNewRoundReady)return!1;var e=v(this,this.roundList.length,Object(g.last)(this.roundList),this.roster.active);return this.roundList.push(e),e},O.prototype.playerMatchHistory=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=this.roundList.length);var r=[];return Object(g.times)(n+1,function(n){void 0!==t.roundList[n]&&t.roundList[n].matches.forEach(function(t){-1!==t.players.indexOf(e)&&r.push(t)})}),r},O.prototype.playerScoreList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.playerMatchHistory(e,t).map(function(t){return t.result[t.players.indexOf(e)]})},O.prototype.playerScore=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,r=this.playerScoreList(e,t);return r.length>0&&(n=r.reduce(function(e,t){return e+t})),n},O.prototype.playerScoreCum=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,r=[];this.playerScoreList(e,t).forEach(function(e){n+=e,r.push(n)});var a=0;return 0!==r.length&&(a=r.reduce(function(e,t){return e+t})),a},O.prototype.playerColorBalance=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;return this.playerMatchHistory(e,t).filter(function(e){return!e.isBye}).forEach(function(t){t.players[0]===e?n+=1:t.players[1]===e&&(n+=-1)}),n},O.prototype.modifiedMedian=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.playerOppHistory(e,n).map(function(e){return t.playerScore(e,n)});a.sort(),r||(a.pop(),a.shift());var i=0;return a.length>0&&(i=a.reduce(function(e,t){return e+t})),i},O.prototype.solkoff=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.modifiedMedian(e,t,!0)},O.prototype.playerOppHistory=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[];return this.playerMatchHistory(e,t).forEach(function(t){n=n.concat(t.players.filter(function(t){return t!==e}))}),n},O.prototype.playerOppScoreCum=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.playerOppHistory(e,n).map(function(e){return t.playerScoreCum(e,n)}),a=0;return 0!==r.length&&(a=r.reduce(function(e,t){return e+t})),a},O.prototype.calcStandings=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.roster.all.map(function(n){return{player:n,score:e.playerScore(n,t),modifiedMedian:e.modifiedMedian(n,t),solkoff:e.solkoff(n,t),scoreCum:e.playerScoreCum(n,t),oppScoreCum:e.playerOppScoreCum(n,t)}});n.sort(Object(b.firstBy)(function(e){return e.score},-1).thenBy(function(e){return e.modifiedMedian},-1).thenBy(function(e){return e.solkoff},-1).thenBy(function(e){return e.scoreCum},-1).thenBy(function(e){return e.oppScoreCum},-1));var r=[],a=0;return n.forEach(function(e,t,n){if(0!==t){var i=n[t-1];e.score===i.score&&e.modifiedMedian===i.modifiedMedian&&e.solkoff===i.solkoff&&e.scoreCum===i.scoreCum&&e.oppScoreCum===i.oppScoreCum||(a+=1)}r[a]||(r[a]=[]),r[a].push(e)}),r};var N=[{firstName:"Matthew",lastName:"A",rating:800},{firstName:"Mark",lastName:"B",rating:850},{firstName:"Luke",lastname:"C",rating:900},{firstName:"John",lastname:"D",rating:950},{firstName:"Simon",lastname:"E",rating:1e3},{firstName:"Andrew",lastname:"F",rating:1050},{firstName:"James",lastname:"G",rating:1100},{firstName:"Philip",lastname:"H",rating:1150},{firstName:"Bartholomew",lastname:"I",rating:1200},{firstName:"Thomas",lastname:"J",rating:1250},{firstName:"Catherine",lastname:"K",rating:1300},{firstName:"Clare",lastname:"L",rating:1350},{firstName:"Judas",lastname:"M",rating:1400},{firstName:"Matthias",lastname:"N",rating:1450},{firstName:"Paul",lastname:"O",rating:1500},{firstName:"Mary",lastname:"P",rating:1600},{firstName:"Theresa",lastname:"Q",rating:1650},{firstName:"Megan",lastname:"R",rating:1700},{firstName:"Elizabeth",lastname:"S",rating:1750}];function k(e){var t=e.tourney,n=Object(r.useState)(t.roster.all),i=Object(o.a)(n,2),l=i[0],c=i[1],u=Object(r.useState)(!1),m=Object(o.a)(u,2),h=m[0],p=m[1],f={firstName:"",lastName:"",rating:1200},d=function(e){f[e.target.name]=e.target.value},y="";return l.length>0&&(y=a.a.createElement("table",null,a.a.createElement("caption",null,"Roster"),a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"First name"),a.a.createElement("th",null,"Rating"),a.a.createElement("th",null,"Rounds played"),a.a.createElement("th",null))),a.a.createElement("tbody",null,l.map(function(e,n){return a.a.createElement("tr",{key:n,className:t.roster.inactive.includes(e)?"inactive":"active"},a.a.createElement("td",{className:"table__player"},e.firstName),a.a.createElement("td",{className:"table__number"},e.rating),a.a.createElement("td",{className:"table__number"},t.playerMatchHistory(e).length),a.a.createElement("td",null,t.roster.inactive.includes(e)?a.a.createElement("button",{onClick:function(){return function(e){t.roster.activatePlayer(e),c([].concat(t.roster.all))}(e)}},"Activate"):a.a.createElement("button",{onClick:function(){return function(e){t.roster.removePlayer(e)||t.roster.deactivatePlayer(e),c([].concat(t.roster.all))}(e)}},"x")))})))),a.a.createElement("div",{className:"roster"},y,a.a.createElement("p",null,a.a.createElement("button",{disabled:h,onClick:function(){var e=N.slice(0,16).map(function(e){return s(e)});t.roster.addPlayers(e),p(!0),c([].concat(t.roster.all))}},"Load a demo roster")),a.a.createElement("p",null,"Or add your own players:"),a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t.addPlayer(s(f.firstName,f.lastName,f.rating)),c([].concat(t.roster.all))}},a.a.createElement("label",null,"First name",a.a.createElement("input",{type:"text",name:"firstName",onChange:d,required:!0})),a.a.createElement("label",null,"Last name",a.a.createElement("input",{type:"text",name:"lastName",onChange:d,required:!0})),a.a.createElement("label",null,"Rating",a.a.createElement("input",{type:"number",name:"rating",onChange:d,value:"1200"})),a.a.createElement("input",{type:"submit",value:"Add"})),a.a.createElement("p",{className:"center"},"Total rounds: ",t.numOfRounds()))}function w(e){var t=e.tourney,n=e.roundId,i=t.roundList[n],l=Object(r.useState)(i.matches.map(function(e){return Object.assign({},e)})),c=Object(o.a)(l,2),u=c[0],s=c[1],m=Object(r.useState)([]),h=Object(o.a)(m,2),p=h[0],f=h[1],d=function(e,t,n){var r=i.matches[t];n.target.checked?0===e?r.whiteWon():1===e?r.blackWon():.5===e&&r.draw():r.resetResult(),s(i.matches.map(function(e){return Object.assign({},e)}))},y=function(e){p.includes(e)?f(p.filter(function(t){return t!==e})):f([].concat(p).concat([e]))};return a.a.createElement("div",null,a.a.createElement("table",{key:i.id,className:"table__roster"},a.a.createElement("caption",null,"Round ",i.id+1," results"),a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"#"),a.a.createElement("th",null,"Won"),a.a.createElement("th",null,"White"),a.a.createElement("th",null,"Draw"),a.a.createElement("th",null,"Black"),a.a.createElement("th",null,"Won"))),a.a.createElement("tbody",null,u.map(function(e,n){return a.a.createElement("tr",{key:n,className:i.matches[n].isBye?"inactive":""},a.a.createElement("td",{className:"table__number"},n+1),a.a.createElement("td",null,a.a.createElement("input",{type:"checkbox",checked:1===i.matches[n].result[0],disabled:i.matches[n].isBye,onChange:function(e){return d(0,n,e)}})),a.a.createElement("td",{className:"table__player"},i.matches[n].whitePlayer.firstName,a.a.createElement("button",{onClick:function(){return y(n)}},"?"),p.includes(n)&&a.a.createElement(R,{tourney:t,round:i,player:i.matches[n].whitePlayer})),a.a.createElement("td",null,a.a.createElement("input",{type:"checkbox",checked:.5===i.matches[n].result[0],disabled:i.matches[n].isBye,onChange:function(e){return d(.5,n,e)}})),a.a.createElement("td",{className:"table__player"},i.matches[n].blackPlayer.firstName,a.a.createElement("button",{onClick:function(){return y(n)}},"?"),p.includes(n)&&a.a.createElement(R,{tourney:t,round:i,player:i.matches[n].blackPlayer})),a.a.createElement("td",null,a.a.createElement("input",{type:"checkbox",checked:1===i.matches[n].result[1],disabled:i.matches[n].isBye,onChange:function(e){return d(1,n,e)}})))}))),a.a.createElement("p",{style:{"text-align":"center"}},a.a.createElement("button",{onClick:function(){u.forEach(function(e,t){var n=i.matches[t],r=Math.random();r>=.55?n.whiteWon():r>=.1?n.blackWon():n.draw()}),s(i.matches.map(function(e){return Object.assign({},e)}))}},"Random!")),a.a.createElement(C,{roundId:i.id,tourney:i.tourney}))}function R(e){var t=e.tourney,n=e.round,r=e.player,i=n.matchByPlayer(r).playerInfo(r).newRating-n.matchByPlayer(r).playerInfo(r).origRating;i>-1&&(i="+"+i);var l=t.playerColorBalance(r,n.id),o="Even";return l>0?o="White +"+l:l<0&&(o="Black +"+Math.abs(l)),a.a.createElement("dl",{className:"player-card"},a.a.createElement("dt",null,"Rating"),a.a.createElement("dd",null,n.matchByPlayer(r).playerInfo(r).origRating,"\xa0(",i,")"),a.a.createElement("dt",null,"Color balance"),a.a.createElement("dd",null,o),a.a.createElement("dt",null,"Opponent history"),a.a.createElement("dd",null,a.a.createElement("ol",null,t.playerOppHistory(r,n.id).map(function(e,t){return a.a.createElement("li",{key:t},e.firstName)}))))}function C(e){var t=e.tourney,n=e.roundId;return a.a.createElement("table",{key:n},a.a.createElement("caption",null,"Current Standings"),a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null),a.a.createElement("th",null,"First name"),a.a.createElement("th",null,"Score"),a.a.createElement("th",null,"Median"),a.a.createElement("th",null,"Solkoff"),a.a.createElement("th",null,"Cumulative"),a.a.createElement("th",null,"Cumulative of opposition"))),t.calcStandings(n).map(function(e,t){return a.a.createElement("tbody",{key:t},e.map(function(e,n){return a.a.createElement("tr",{key:n},a.a.createElement("td",null,t+1),a.a.createElement("td",null,e.player.firstName),a.a.createElement("td",{className:"table__number"},e.score),a.a.createElement("td",{className:"table__number"},e.modifiedMedian),a.a.createElement("td",{className:"table__number"},e.solkoff),a.a.createElement("td",{className:"table__number"},e.scoreCum),a.a.createElement("td",{className:"table__number"},e.oppScoreCum))}))}))}var j=new O("CVL Winter Open",15);var P=function(){var e=Object(r.useState)([{name:"Roster",contents:a.a.createElement(k,{tourney:j})}]),t=Object(o.a)(e,2),n=t[0],i=t[1],l=Object(r.useState)(n[0]),c=Object(o.a)(l,2),u=c[0],s=c[1];return a.a.createElement("div",{className:"tournament"},a.a.createElement("nav",{className:"tabbar"},a.a.createElement("ul",null,n.map(function(e,t){return a.a.createElement("li",{key:t},a.a.createElement("button",{className:"tab",onClick:function(){return s(e)},disabled:u===e},e.name))}),a.a.createElement("li",null,a.a.createElement("button",{className:"tab new_round",onClick:function(e){var t=j.newRound();t?(n.push({name:"Round "+(t.id+1),contents:a.a.createElement(w,{tourney:j,roundId:t.id})}),i([].concat(n)),s(n[n.length-1])):alert("Either add players or complete the current matches first.")}},"New Round")))),a.a.createElement("h1",null,"Chessahoochee: a chess tournament app"),u.contents)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(a.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,1,2]]]);
//# sourceMappingURL=main.ae5555ad.chunk.js.map