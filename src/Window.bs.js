// Generated by BUCKLESCRIPT VERSION 6.0.3, PLEASE EDIT WITH CARE

import * as Cn from "re-classnames/src/Cn.bs.js";
import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Caml_option from "bs-platform/lib/es6/caml_option.js";
import * as Dialog from "@reach/dialog";
import * as ReactFeather from "react-feather";
import * as Icons$Coronate from "./Icons.bs.js";
import * as DialogAbout$Coronate from "./DialogAbout.bs.js";
import * as VisuallyHidden from "@reach/visually-hidden";
import * as ElectronUtils$Coronate from "./ElectronUtils.bs.js";

var global_title = "Coronate";

function formatTitle(title) {
  var match = title.length === 0;
  if (match) {
    return global_title;
  } else {
    return title + " - Coronate";
  }
}

var initialWinState = /* record */[
  /* isBlur */false,
  /* isDialogOpen */false,
  /* isFullScreen */false,
  /* isMaximized */false,
  /* isSidebarOpen */true,
  /* title */""
];

function initialState_001(param) {
  return /* () */0;
}

var initialState = /* tuple */[
  initialWinState,
  initialState_001
];

var windowContext = React.createContext(initialState);

function makeProps(value, children, param) {
  return {
          value: value,
          children: children
        };
}

var make = windowContext.Provider;

var Provider = /* module */[
  /* makeProps */makeProps,
  /* make */make
];

function useWindowContext(param) {
  return React.useContext(windowContext);
}

var WindowContext = /* module */[
  /* initialState */initialState,
  /* windowContext */windowContext,
  /* Provider */Provider,
  /* useWindowContext */useWindowContext
];

function windowReducer(state, action) {
  switch (action.tag | 0) {
    case 0 : 
        return /* record */[
                /* isBlur */action[0],
                /* isDialogOpen */state[/* isDialogOpen */1],
                /* isFullScreen */state[/* isFullScreen */2],
                /* isMaximized */state[/* isMaximized */3],
                /* isSidebarOpen */state[/* isSidebarOpen */4],
                /* title */state[/* title */5]
              ];
    case 1 : 
        return /* record */[
                /* isBlur */state[/* isBlur */0],
                /* isDialogOpen */action[0],
                /* isFullScreen */state[/* isFullScreen */2],
                /* isMaximized */state[/* isMaximized */3],
                /* isSidebarOpen */state[/* isSidebarOpen */4],
                /* title */state[/* title */5]
              ];
    case 2 : 
        return /* record */[
                /* isBlur */state[/* isBlur */0],
                /* isDialogOpen */state[/* isDialogOpen */1],
                /* isFullScreen */action[0],
                /* isMaximized */state[/* isMaximized */3],
                /* isSidebarOpen */state[/* isSidebarOpen */4],
                /* title */state[/* title */5]
              ];
    case 3 : 
        return /* record */[
                /* isBlur */state[/* isBlur */0],
                /* isDialogOpen */state[/* isDialogOpen */1],
                /* isFullScreen */state[/* isFullScreen */2],
                /* isMaximized */action[0],
                /* isSidebarOpen */state[/* isSidebarOpen */4],
                /* title */state[/* title */5]
              ];
    case 4 : 
        return /* record */[
                /* isBlur */state[/* isBlur */0],
                /* isDialogOpen */state[/* isDialogOpen */1],
                /* isFullScreen */state[/* isFullScreen */2],
                /* isMaximized */state[/* isMaximized */3],
                /* isSidebarOpen */action[0],
                /* title */state[/* title */5]
              ];
    case 5 : 
        return /* record */[
                /* isBlur */state[/* isBlur */0],
                /* isDialogOpen */state[/* isDialogOpen */1],
                /* isFullScreen */state[/* isFullScreen */2],
                /* isMaximized */state[/* isMaximized */3],
                /* isSidebarOpen */state[/* isSidebarOpen */4],
                /* title */action[0]
              ];
    
  }
}

var toolbarClasses = Cn.make(/* :: */[
      Cn.ifTrue("macos-button-toolbar", ElectronUtils$Coronate.isMac && ElectronUtils$Coronate.isElectron),
      /* :: */[
        Cn.ifTrue("button-ghost", !(ElectronUtils$Coronate.isMac && ElectronUtils$Coronate.isElectron)),
        /* [] */0
      ]
    ]);

function Window$WindowsControls(Props) {
  var state = Props.state;
  var middleButton = state[/* isFullScreen */2] ? React.createElement("button", {
          className: "windosControls__winButton button-ghost",
          onClick: (function (param) {
              return ElectronUtils$Coronate.currentWindow.setFullScreen(false);
            })
        }, React.createElement(ReactFeather.Minimize2, { })) : (
      state[/* isMaximized */3] ? React.createElement("button", {
              className: "windosControls__winButton button-ghost",
              onClick: (function (param) {
                  return ElectronUtils$Coronate.currentWindow.unmaximize();
                })
            }, React.createElement(Icons$Coronate.Restore[/* make */0], { })) : React.createElement("button", {
              className: "windosControls__winButton button-ghost",
              onClick: (function (param) {
                  return ElectronUtils$Coronate.currentWindow.maximize();
                })
            }, React.createElement(Icons$Coronate.Maximize[/* make */0], { }))
    );
  return React.createElement("div", {
              className: "windowsControls__container"
            }, React.createElement("button", {
                  className: "windowsControls__winButton button-ghost",
                  onClick: (function (param) {
                      return ElectronUtils$Coronate.currentWindow.minimize();
                    })
                }, React.createElement(Icons$Coronate.Minimize[/* make */0], { })), middleButton, React.createElement("button", {
                  className: Cn.make(/* :: */[
                        "windowsControls__winButton",
                        /* :: */[
                          "windowsControls__close",
                          /* :: */[
                            "button-ghost",
                            /* [] */0
                          ]
                        ]
                      ]),
                  onClick: (function (param) {
                      return ElectronUtils$Coronate.currentWindow.close();
                    })
                }, React.createElement(Icons$Coronate.Close[/* make */0], { })));
}

var WindowsControls = /* module */[/* make */Window$WindowsControls];

function Window$WindowTitleBar(Props) {
  var state = Props.state;
  var dispatch = Props.dispatch;
  return React.createElement("header", {
              className: Cn.make(/* :: */[
                    "app__header",
                    /* :: */[
                      "double-click-control",
                      /* :: */[
                        Cn.ifTrue("traffic-light-padding", ElectronUtils$Coronate.isElectron && ElectronUtils$Coronate.isMac && !state[/* isFullScreen */2]),
                        /* [] */0
                      ]
                    ]
                  ]),
              onDoubleClick: ElectronUtils$Coronate.macOSDoubleClick
            }, React.createElement("div", undefined, React.createElement(ElectronUtils$Coronate.IfElectron[/* make */0], {
                      children: React.createElement("span", {
                            style: {
                              display: "inline-flex",
                              marginRight: "8px",
                              marginLeft: "4px",
                              alignItems: "center"
                            }
                          }),
                      onlyWin: true
                    }), React.createElement("button", {
                      className: toolbarClasses,
                      onClick: (function (param) {
                          return Curry._1(dispatch, /* SetSidebar */Block.__(4, [!state[/* isSidebarOpen */4]]));
                        })
                    }, React.createElement(ReactFeather.Sidebar, { }), React.createElement(VisuallyHidden, {
                          children: "Toggle sidebar"
                        })), React.createElement("button", {
                      className: toolbarClasses,
                      onClick: (function (param) {
                          return Curry._1(dispatch, /* SetDialog */Block.__(1, [true]));
                        })
                    }, React.createElement(ReactFeather.HelpCircle, { }), React.createElement(VisuallyHidden, {
                          children: "About Coronate"
                        }))), React.createElement("div", {
                  className: Cn.make(/* :: */[
                        "body-20",
                        /* :: */[
                          "double-click-control",
                          /* :: */[
                            Cn.ifTrue("disabled", state[/* isBlur */0]),
                            /* [] */0
                          ]
                        ]
                      ]),
                  style: {
                    left: "0",
                    marginRight: "auto",
                    marginLeft: "auto",
                    position: "absolute",
                    right: "0",
                    textAlign: "center",
                    width: "50%"
                  }
                }, formatTitle(state[/* title */5])), React.createElement(ElectronUtils$Coronate.IfElectron[/* make */0], {
                  children: React.createElement(Window$WindowsControls, {
                        state: state
                      }),
                  onlyWin: true
                }));
}

var WindowTitleBar = /* module */[/* make */Window$WindowTitleBar];

function make$1(children, className) {
  var match = React.useReducer(windowReducer, initialWinState);
  var dispatch = match[1];
  var state = match[0];
  React.useEffect((function () {
          document.title = formatTitle(state[/* title */5]);
          return undefined;
        }), /* array */[state[/* title */5]]);
  React.useEffect((function () {
          var func = ElectronUtils$Coronate.ifElectron((function (param) {
                  var unregisterListeners = function (param) {
                    ElectronUtils$Coronate.currentWindow.removeAllListeners("enter-full-screen");
                    ElectronUtils$Coronate.currentWindow.removeAllListeners("leave-full-screen");
                    ElectronUtils$Coronate.currentWindow.removeAllListeners("blur");
                    ElectronUtils$Coronate.currentWindow.removeAllListeners("focus");
                    ElectronUtils$Coronate.currentWindow.removeAllListeners("maximize");
                    return ElectronUtils$Coronate.currentWindow.removeAllListeners("unmaximize");
                  };
                  unregisterListeners(/* () */0);
                  ElectronUtils$Coronate.currentWindow.on("enter-full-screen", (function (param) {
                          return Curry._1(dispatch, /* SetFullScreen */Block.__(2, [true]));
                        }));
                  ElectronUtils$Coronate.currentWindow.on("leave-full-screen", (function (param) {
                          return Curry._1(dispatch, /* SetFullScreen */Block.__(2, [false]));
                        }));
                  ElectronUtils$Coronate.currentWindow.on("maximize", (function (param) {
                          return Curry._1(dispatch, /* SetMaximized */Block.__(3, [true]));
                        }));
                  ElectronUtils$Coronate.currentWindow.on("unmaximize", (function (param) {
                          return Curry._1(dispatch, /* SetMaximized */Block.__(3, [false]));
                        }));
                  ElectronUtils$Coronate.currentWindow.on("blur", (function (param) {
                          return Curry._1(dispatch, /* SetBlur */Block.__(0, [true]));
                        }));
                  ElectronUtils$Coronate.currentWindow.on("focus", (function (param) {
                          return Curry._1(dispatch, /* SetBlur */Block.__(0, [false]));
                        }));
                  Curry._1(dispatch, /* SetBlur */Block.__(0, [ElectronUtils$Coronate.currentWindow.isFocused()]));
                  Curry._1(dispatch, /* SetFullScreen */Block.__(2, [!ElectronUtils$Coronate.currentWindow.isFocused()]));
                  Curry._1(dispatch, /* SetMaximized */Block.__(3, [ElectronUtils$Coronate.currentWindow.isMaximized()]));
                  return unregisterListeners;
                }));
          if (func !== undefined) {
            return Caml_option.valFromOption(func);
          }
          
        }), ([]));
  return React.createElement("div", {
              className: Cn.make(/* :: */[
                    className,
                    /* :: */[
                      Cn.ifTrue("open-sidebar", state[/* isSidebarOpen */4]),
                      /* :: */[
                        Cn.ifTrue("closed-sidebar", !state[/* isSidebarOpen */4]),
                        /* :: */[
                          Cn.ifTrue("window-blur", state[/* isBlur */0]),
                          /* :: */[
                            Cn.ifTrue("isWindows", ElectronUtils$Coronate.isWin),
                            /* :: */[
                              Cn.ifTrue("isMacOS", ElectronUtils$Coronate.isMac),
                              /* :: */[
                                Cn.ifTrue("isElectron", ElectronUtils$Coronate.isElectron),
                                /* [] */0
                              ]
                            ]
                          ]
                        ]
                      ]
                    ]
                  ])
            }, React.createElement(Window$WindowTitleBar, {
                  state: state,
                  dispatch: dispatch
                }), React.createElement(make, makeProps(/* tuple */[
                      state,
                      dispatch
                    ], children, /* () */0)), React.createElement(Dialog, {
                  isOpen: state[/* isDialogOpen */1],
                  onDismiss: (function (param) {
                      return Curry._1(dispatch, /* SetDialog */Block.__(1, [false]));
                    }),
                  children: null,
                  style: {
                    backgroundColor: "var(--grey-20)"
                  }
                }, React.createElement("button", {
                      className: "button-micro",
                      onClick: (function (param) {
                          return Curry._1(dispatch, /* SetDialog */Block.__(1, [false]));
                        })
                    }, "Close"), React.createElement(DialogAbout$Coronate.make, { })));
}

var $$Window = /* module */[/* make */make$1];

export {
  global_title ,
  formatTitle ,
  initialWinState ,
  WindowContext ,
  windowReducer ,
  toolbarClasses ,
  WindowsControls ,
  WindowTitleBar ,
  $$Window ,
  
}
/* windowContext Not a pure module */
